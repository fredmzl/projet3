#!/usr/bin/env bash
#MISE description="Stop frontend server"

set -e
PIDFILE="${MISE_CONFIG_ROOT}/.frontend.pid"

if [ ! -f "$PIDFILE" ]; then
    echo "❌ Frontend is not running (no PID file found)"
    exit 1
fi

PID=$(cat "$PIDFILE")

if ps -p "$PID" > /dev/null 2>&1; then
    echo "Stopping frontend server (PID: $PID)..."
    # Kill the entire process group to stop all child processes
    kill -- -$(ps -o pgid= -p "$PID" | grep -o '[0-9]*') 2>/dev/null || kill "$PID"
    rm "$PIDFILE"
    echo "✅ Frontend stopped"
else
    echo "❌ Process not found (cleaning up PID file)"
    rm "$PIDFILE"
    exit 1
fi
