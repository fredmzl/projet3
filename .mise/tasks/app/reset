#!/usr/bin/env bash
#MISE description="Reset application and all data (database + storage)"
#MISE arg "--restart" help="restart app after reset" default="false"

set -e

echo "=========================================="
echo "âš ï¸  WARNING: Application Reset"
echo "=========================================="
echo ""
echo "This will:"
echo "  - Stop all services (backend + frontend)"
echo "  - Delete all database data"
echo "  - Delete all uploaded files"
echo ""
read -p "Are you sure? (yes/no): " confirmation

if [ "$confirmation" != "yes" ]; then
    echo "âŒ Reset cancelled"
    exit 0
fi

# Check if --storage flag is provided
RESTART=false
if [[ "$1" == "--restart" ]] || [[ "$2" == "--restart" ]]; then
    RESTART=true
fi

echo ""
echo "=========================================="
echo "ğŸ”„ Resetting Application"
echo "=========================================="
echo ""

# Stop application
echo "ğŸ›‘ Stopping application..."
mise run app:stop 2>/dev/null || echo "   Services already stopped"
echo ""

# Flush database and storage
echo "ğŸ—‘ï¸  Flushing database and storage..."
mise run database:flush --storage
echo ""
# Restart application if requested
if [ "$RESTART" = true ]; then
    echo "ğŸ”„ Restarting application..."
    mise run app:start
    echo ""
else
    echo "=========================================="
    echo "âœ… Application reset completed!"
    echo "=========================================="
    echo ""
    echo "ğŸ“‹ Next steps:"
    echo "   mise run app:start              - Start application"
    echo "   mise run database:bootstrap     - Create test data"
    echo ""
fi








